# Audio Mixer для технических интервью

## Описание

Система помощи при техническом интервью с двухканальным аудио миксером, который позволяет:

- **P1 (Интервьюер)**: Перехватывать аудио из Zoom/Google Meet через VB Cable
- **P2 (Собеседник)**: Захватывать аудио с микрофона
- **Автоматическое распознавание**: Определение вопросов от интервьюера
- **AI помощь**: Генерация ответов и подсказок через телепромптер

## Архитектура системы

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│  Zoom/Meet      │    │   VB Cable       │    │  Audio Mixer    │
│  (P1 - Вопросы) │───▶│  (Перенапр.)     │───▶│  (Сервер)       │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                                                         │
┌─────────────────┐                                     │
│  Микрофон       │                                     │
│  (P2 - Ответы)  │────────────────────────────────────▶│
└─────────────────┘                                     │
                                                         ▼
                                                ┌─────────────────┐
                                                │  AI Assistant   │
                                                │  + Teleprompter │
                                                └─────────────────┘
```

## Компоненты системы

### 1. Audio Mixer (`audio-mixer.html`)
- **Назначение**: Центральная панель управления аудио потоками
- **Функции**:
  - Визуализация уровней аудио для P1 и P2
  - Мониторинг WebSocket подключений
  - Управление записью
  - Логирование аудио событий

### 2. Audio Capture (`audio-capture.html`)
- **Назначение**: Захват аудио с устройств
- **Функции**:
  - Автоматическое определение VB Cable
  - Захват с микрофона (P2)
  - Отправка аудио чанков на сервер
  - Тестирование аудио устройств

### 3. Teleprompter (`teleprompter.html`)
- **Назначение**: Отображение подсказок и ответов
- **Функции**:
  - Поддержка синтаксиса кода
  - LaTeX формулы
  - AI-генерируемые ответы

## Установка и настройка

### 1. Установка VB-Audio Cable

1. Скачайте VB-Audio Cable с официального сайта
2. Установите драйвер
3. Перезагрузите компьютер
4. В настройках звука установите VB Cable как устройство воспроизведения для Zoom/Google Meet

### 2. Настройка OpenAI API

Создайте файл `.env` в корне проекта:

```env
OPENAI_API_KEY=sk-your-api-key-here
PORT=3000
```

### 3. Установка зависимостей

```bash
npm install
npm start
```

## Использование

### Пошаговый процесс

1. **Подготовка**:
   - Запустите сервер: `npm start`
   - Откройте `http://localhost:3000` в браузере
   - Убедитесь, что VB Cable настроен в Zoom/Google Meet

2. **Настройка захвата**:
   - Перейдите на страницу "Audio Capture"
   - Разрешите доступ к микрофону
   - Проверьте, что VB Cable определился автоматически
   - Нажмите "Начать захват"

3. **Мониторинг**:
   - Откройте "Audio Mixer" в новой вкладке
   - Наблюдайте за уровнями аудио P1 и P2
   - Контролируйте статус подключений

4. **Интервью**:
   - При получении вопроса от P1 (VB Cable), система автоматически его распознает
   - Ответы можно видеть в телепромптере
   - P2 (микрофон) записывает ваши ответы

### Веб-интерфейсы

#### Главная страница (`/`)
- Обзор системы
- Навигация между компонентами
- Статус всех сервисов
- Быстрый старт

#### Audio Mixer (`/audio-mixer.html`)
- **P1 канал**: Красный бейдж, VB Cable источник
- **P2 канал**: Зеленый бейдж, микрофон источник
- **Визуализация**: Анимированные уровни аудио
- **Управление**: Старт/стоп записи
- **Лог**: История аудио событий

#### Audio Capture (`/audio-capture.html`)
- **Устройства**: Список доступных аудио входов
- **Тестирование**: Проверка уровня сигнала
- **Статус потоков**: P1 и P2 в реальном времени
- **Отладка**: Подробное логирование

## API Reference

### WebSocket Events

```javascript
// Установка типа клиента
{ type: 'set-person', person: 'P1' | 'P2' | 'mixer' }

// Аудио чанк
{ 
  type: 'audio-chunk', 
  person: 'P1' | 'P2',
  audioData: 'base64_encoded_audio',
  timestamp: number 
}

// Управление записью
{ type: 'start-recording' }
{ type: 'stop-recording' }
```

### HTTP Endpoints

```bash
# Статус системы
GET /api/audio/status

# Управление записью
POST /api/audio/start
POST /api/audio/stop

# Загрузка аудио
POST /api/audio/upload/p1  # VB Cable
POST /api/audio/upload/p2  # Микрофон

# Конфигурация
GET /api/audio/config

# Здоровье сервера
GET /api/health
```

## Отладка и решение проблем

### VB Cable не определяется
```javascript
// Проверьте доступные устройства
navigator.mediaDevices.enumerateDevices()
  .then(devices => {
    const audioInputs = devices.filter(d => d.kind === 'audioinput');
    console.log('Аудио устройства:', audioInputs);
  });
```

### Нет разрешения на микрофон
```javascript
// Запросите разрешения
navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    console.log('Доступ к микрофону получен');
    stream.getTracks().forEach(track => track.stop());
  })
  .catch(err => console.error('Ошибка доступа:', err));
```

### WebSocket не подключается
- Проверьте, что сервер запущен на правильном порту
- Убедитесь, что нет блокировки файрвола
- Проверьте консоль браузера на ошибки

### Аудио чанки не отправляются
- Убедитесь, что MediaRecorder поддерживается
- Проверьте MIME-тип аудио (`audio/webm;codecs=opus`)
- Проверьте размер чанков (лимит 10MB)

## Технические детали

### Формат аудио
- **Кодек**: Opus в WebM контейнере
- **Частота дискретизации**: 44.1kHz
- **Каналы**: Моно (1 канал)
- **Длительность чанка**: 1 секунда

### WebSocket архитектура
- **Сервер**: Node.js с библиотекой `ws`
- **Клиенты**: Браузерные WebSocket соединения
- **Протокол**: JSON сообщения
- **Переподключение**: Автоматическое с экспоненциальной задержкой

### Безопасность
- CORS настроен для локальной разработки
- Аудио данные передаются в base64
- API ключи хранятся в переменных окружения
- Нет постоянного хранения аудио данных

## Расширение функциональности

### Добавление нового типа события

1. **Серверная часть** (`server.js`):
```javascript
function handleAudioMessage(ws, data) {
  switch (data.type) {
    case 'your-new-event':
      handleYourNewEvent(data);
      break;
    // ...
  }
}
```

2. **Клиентская часть**:
```javascript
// Отправка события
ws.send(JSON.stringify({
  type: 'your-new-event',
  payload: { /* your data */ }
}));

// Обработка ответа
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'your-event-response') {
    // handle response
  }
};
```

### Интеграция с другими сервисами

Система легко расширяется для интеграции с:
- Speech-to-Text сервисами (Google Speech, Azure)
- Другими AI моделями (Claude, GPT-4)
- Системами видеоконференций
- Базами данных для логирования

## Производительность

### Рекомендации
- **CPU**: Современный многоядерный процессор для обработки аудио
- **RAM**: Минимум 4GB для комфортной работы
- **Сеть**: Стабильное интернет соединение для AI запросов
- **Браузер**: Chrome/Firefox с поддержкой WebRTC

### Мониторинг
- Следите за использованием памяти в DevTools
- Контролируйте количество WebSocket соединений
- Ограничивайте размер логов аудио событий
- Периодически очищайте кеш сервера

## Лицензия

MIT License - см. файл LICENSE для деталей.

## Поддержка

Для вопросов и проблем создавайте Issues в репозитории или обращайтесь к документации API.