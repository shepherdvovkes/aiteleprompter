# Исправление ошибки подключения к OpenAI API

## Проблема
При попытке использовать приложение возникает ошибка: **"OpenAI API error 401: Incorrect API key provided"**

## Причина ошибки
Отсутствует правильно настроенный API ключ OpenAI в файле окружения `.env`.

## Решение

### Шаг 1: Получение API ключа OpenAI

1. Перейдите на сайт: https://platform.openai.com/api-keys
2. Войдите в свой аккаунт OpenAI (или создайте новый)
3. Нажмите "Create new secret key" (Создать новый секретный ключ)
4. Скопируйте **полный** API ключ (он начинается с `sk-proj-` и имеет длину около 51+ символов)

### Шаг 2: Настройка файла .env

1. Откройте файл `.env` в корневой папке проекта
2. Найдите строку: `OPENAI_API_KEY=your_openai_api_key_here`
3. Замените `your_openai_api_key_here` на ваш настоящий API ключ

**Пример:**
```
# До изменения
OPENAI_API_KEY=your_openai_api_key_here

# После изменения (вставьте ваш реальный ключ)
OPENAI_API_KEY=sk-proj-ВАSH_ПОЛНЫЙ_API_КЛЮЧ_ЗДЕСЬ_ДЛИННЫЙ_КЛЮЧ
```

### Шаг 3: Перезапуск сервера

```bash
# Остановите текущий сервер (Ctrl+C если запущен в терминале)
# Или используйте:
pkill -f "node server.js"

# Запустите сервер заново
npm start
```

### Шаг 4: Проверка исправления

1. Откройте браузер и перейдите по адресу: http://localhost:3000
2. Приложение должно подключиться к API без ошибок
3. Вы можете протестировать API командой:
   ```bash
   curl -X POST http://localhost:3000/api/chat \
     -H "Content-Type: application/json" \
     -d '{"model":"gpt-4o-mini","messages":[{"role":"user","content":"Привет"}]}'
   ```

## Важные замечания

### Безопасность API ключа
- ⚠️ **Никогда не публикуйте ваш API ключ в публичных репозиториях**
- ⚠️ **Не передавайте API ключ другим людям**
- ⚠️ **Регулярно проверяйте использование API в личном кабинете OpenAI**

### Формат правильного API ключа
- Начинается с `sk-proj-`
- Имеет длину около 51+ символов
- Содержит буквы, цифры и специальные символы

### Пример неправильного ключа (из лога ошибки):
`sk-proj-eMV2ES_jhgjhg` - **слишком короткий** (21 символ)

### Пример правильного ключа:
`sk-proj-ABCDEF1234567890abcdef1234567890ABCDEF1234567890abcdef` - **полный ключ** (51+ символов)

## Альтернативные варианты настройки

### Вариант 1: Настройка через веб-интерфейс
Если не хотите использовать серверный API ключ:
1. Откройте http://localhost:3000
2. Нажмите кнопку "Settings" (шестеренка)
3. Введите ваш API ключ в поле "OpenAI API Key"
4. Нажмите "Save"

### Вариант 2: Переменные окружения
Можете также задать переменную окружения:
```bash
export OPENAI_API_KEY="ваш_api_ключ_здесь"
npm start
```

## Проверка статуса

### Проверка здоровья сервера:
```bash
curl http://localhost:3000/api/health
```
Должен вернуть: `{"status":"ok","timestamp":"...","cache_size":0}`

### Проверка подключения к API:
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"model":"gpt-4o-mini","messages":[{"role":"user","content":"тест"}]}'
```
Должен вернуть ответ от AI, а не ошибку аутентификации.

## Возможные дополнительные ошибки

### Ошибка 429 - превышение лимита
- **Причина**: Превышен лимит запросов или недостаточно средств на счету
- **Решение**: Проверьте баланс и лимиты в личном кабинете OpenAI

### Ошибка 403 - доступ запрещен
- **Причина**: API ключ не имеет необходимых разрешений
- **Решение**: Убедитесь, что ваш аккаунт имеет доступ к API

### Ошибка подключения
- **Причина**: Проблемы с интернетом или блокировка OpenAI API
- **Решение**: Проверьте интернет-соединение и доступность api.openai.com

## Статус исправления

✅ Создан файл `.env` с правильной структурой
✅ Улучшена обработка ошибок в `server.js`
✅ Добавлены подробные инструкции по настройке

❌ **ТРЕБУЕТСЯ ДЕЙСТВИЕ**: Добавьте ваш настоящий OpenAI API ключ в файл `.env`

После добавления правильного API ключа и перезапуска сервера, ошибка подключения к OpenAI API будет исправлена.